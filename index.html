<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Luks-unlock-by-usb-ssh-passphrase by mpuetz</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Luks-unlock-by-usb-ssh-passphrase</h1>
        <h2>a hook-script for ubuntu server 14.04 to unlock a LUKS-drive at boot, using ssh, an usb-drive or passphrase</h2>

        <section id="downloads">
          <a href="https://github.com/mpuetz/LUKS-unlock-by-usb-ssh-passphrase/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/mpuetz/LUKS-unlock-by-usb-ssh-passphrase/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/mpuetz/LUKS-unlock-by-usb-ssh-passphrase" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="luks-unlock-by-usb-ssh-passphrase" class="anchor" href="#luks-unlock-by-usb-ssh-passphrase" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>LUKS-unlock-by-usb-ssh-passphrase</h1>

<p>a hook-script for ubuntu server 14.04 and 16.04 to unlock a LUKS-drive at boot, using ssh, an usb-drive or passphrase</p>

<pre><code>    CAUTION! Usage of this file happens on your own risk!
</code></pre>

<p>This script has been tested on ubuntu 14.04 and 16.04 on fresh installations/upgrades. Unfortunately, I do not have the possibility to test it more detailed.</p>

<p>This script is based on the LUKS-tripple-unlock script (<a href="https://github.com/chadoe/luks-triple-unlock">https://github.com/chadoe/luks-triple-unlock</a>) by Martin van Beurden, </p>

<p>on the tutorial Entschl√ºsseln mit einem USB-Stick (<a href="https://wiki.ubuntuusers.de/System_verschl%C3%BCsseln/Entschl%C3%BCsseln_mit_einem_USB-Schl%C3%BCssel/">https://wiki.ubuntuusers.de/System_verschl%C3%BCsseln/Entschl%C3%BCsseln_mit_einem_USB-Schl%C3%BCssel/</a> ),
Revision from 14. Juni 2016 08:32 last edited by noisefloor and originally created by Franco_bez (<a href="https://ubuntuusers.de/user/franco_bez/">https://ubuntuusers.de/user/franco_bez/</a>)</p>

<p>and decryptkeydevice by Franco_bez (<a href="https://ubuntuusers.de/user/franco_bez/">https://ubuntuusers.de/user/franco_bez/</a>) as found at (<a href="https://wiki.ubuntuusers.de/System_verschl%C3%BCsseln/Entschl%C3%BCsseln_mit_einem_USB-Schl%C3%BCssel/#Anlegen-der-noetigen-Konfigurationsdateien">https://wiki.ubuntuusers.de/System_verschl%C3%BCsseln/Entschl%C3%BCsseln_mit_einem_USB-Schl%C3%BCssel/#Anlegen-der-noetigen-Konfigurationsdateien</a>), published under CC BY-NC-SA 2.0 DE (<a href="http://creativecommons.org/licenses/by-nc-sa/2.0/de/deed.de">http://creativecommons.org/licenses/by-nc-sa/2.0/de/deed.de</a>).</p>

<p>All credits and rights for these scripts belong to them.</p>

<p>I made this script beecause I used an usb-drive to unlock my server. Because i wanted to be able to remotely reboot the server if necessary,
I had to let the usb-drive plugged into the server, which makes any encryption more or less useless. Because of that I began searching
for other ways to unlock the serverand found the script i metnioned above, which was very similar to the script I already used for unlocking.
After having read both of them it was clear they have got the same roots, so I thought it schould be possible to combine them, which is
exactly what I did.</p>

<p>This Script was tested on Ubuntu Server 14.04. I am not responsible for any changes you make to your system. Continue with caution and ensure to have an initramfs-backup you can use to boot if something strange happens.</p>

<p>The script works for me when having one LVM to unlock. This script also works with RAID 1.</p>

<p>This script uses dropbear. For detailed instructions how to set up dropbear, please use the following article: 
<a href="https://www.thomas-krenn.com/de/wiki/Voll-verschl%C3%BCsseltes-System_via_SSH_freischalten">https://www.thomas-krenn.com/de/wiki/Voll-verschl%C3%BCsseltes-System_via_SSH_freischalten</a></p>

<p>How to install this file:</p>

<ul>
<li>connect the usb-drive to the machine</li>
<li>on your machine (or via ssh) run "sudo ls -l /dev/disk/by-id" and watch out for your usb-drive.</li>
<li>Write down the id of your usb-drive (usb-XXXX-0:0) and the label (../../sdX  WITHOUT any partiton number (NOT sdX1))</li>
<li>run "sudo fdisk -l /dev/sdX" and replace sdX with the label you have written down before. Write down the blocksize (like 512 bytes), you just need the number! Please also write down the beginning of the first partition (sdX1).</li>
<li>write down the label of the encrypted partition. If you don't know which device this partition is on, run 'sudo fdisk -l | grep "*"'. This will show you the boot-partiton. Because you are using a script to unlock your machine while booting this will mostly get the right device. Please write the label down INCLUDING the partition-number (/dev/sdXY). </li>
<li>get both of the scripts to your server using "wget <a href="https://codeload.github.com/mpuetz/LUKS-unlock-by-usb-ssh-passphrase/legacy.zip/master">https://codeload.github.com/mpuetz/LUKS-unlock-by-usb-ssh-passphrase/legacy.zip/master</a> &amp;&amp; unzip master &amp;&amp; cd mpuetz-LUKS-unlock-by-usb-ssh-passphrase-fce9afc &amp;&amp; sudo chmod +x install.sh".</li>
<li>run the install.sh installation script.</li>
<li>If you want to add the possibility, to login to dropbear using key-files, please do this now and after that run "sudo update-initramfs -c -k 'uname -r'"</li>
</ul>

<p>How to use this file:</p>

<ul>
<li>Using the passphrase:
You can just type in the passphrase using a keyboard connected to the server.</li>
<li>Using SSH:
After loging in to the server, you get asked for the passphrase. If you enter it correctly, the device will be unlockend.</li>
<li>Using an usb-drive:
Using this method, you create a key-file on your usb-drive, but instead of just creating a normal file, it will write the key at the beginning
of the drive. So there is nothing blowing up your cover for your encrypted harddrive.</li>
</ul>

<p>One last word concerning the License:
unfortunately, here are two projects merged which are published under different Licenses. The install.sh-script from Martin van Beurden
may be used under the MIT-License, whereas the script from Franco_be which is found at ubuntuusers.de has to be published under the 
CC BY-NC-SA 2.0 DE by the forum-guidelines from ubuntuusers.de.
So its a bit unclear which License to use. Because the MIT-License is pretty easy, whereas the CC-License is pretty restrictive it 
seems to be the most logical decission to use this License for the scripts. I hope this is okay with everyone who contributed to the 
scripts I used. If it does not, please feel free to contact me so we can decide how to go on.</p>
      </section>
    </div>

    
  </body>
</html>
